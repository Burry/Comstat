extends layout

block content
    header
        .container
            .row
                .col-12
                    h1.display-4
                        if icon
                            i.fa(class=icon, aria-hidden='true')
                        else
                            img.logo(src='images/logo.svg')
                        | &nbsp;
                        =title
            .row#loader
                .col-12
                    i.fa.fa-spin.fa-circle-o-notch(aria-hidden='true')
                    |  Querying Comcast (this takes a while)
            .row
                .col-11
                    p#data
                        | Used&nbsp;
                        span#data_used
                        | /
                        span#data_total
                        | &nbsp;GB
                        br
                        span#data_remaining
                        | &nbsp;GB remaining
                .col-1
                    button#reload.btn.btn-secondary(type='button')
                        i.fa.fa-refresh(aria-hidden='true')
            .row
                .col-12
                    #data_progress.progress
                        .progress-bar.progress-bar-striped.progress-bar-animated.bg-danger(role='progressbar', aria-valuenow='0', aria-valuemin='0', aria-valuemax='100', style='width: 75%')
            script.
                function loadComcastQuery() {
                    $.get("response", function(data) {
                        var res = JSON.parse(data);
                        var remaining = res.total - res.used;
                        var percent = 100 * res.used / res.total;
                        $("#loader").hide();
                        $("#data_used").html(res.used);
                        $("#data_total").html(res.total);
                        $("#data_remaining").html(remaining);
                        $(".progress-bar").html(Math.round(percent) + "%");
                        $(".progress-bar").css("width", percent + "%");
                        $("#data").css("display", "block");
                        $("#data_progress").css("display", "block");
                        $("#reload").css("display", "block");
                    });
                }

                function reloadComcastQuery() {
                    $(".fa-refresh").addClass("fa-spin");
                    $("#data_used").addClass("half-transparent");
                    $("#data_total").addClass("half-transparent");
                    $("#data_remaining").addClass("half-transparent");
                    $(".progress-bar").addClass("half-transparent");
                    $.get("response", function(data) {
                        var res = JSON.parse(data);
                        var remaining = res.total - res.used;
                        var percent = 100 * res.used / res.total;
                        $("#data_used").html(res.used);
                        $("#data_total").html(res.total);
                        $("#data_remaining").html(remaining);
                        $(".progress-bar").html(Math.round(percent) + "%");
                        $(".progress-bar").css("width", percent + "%");
                        $(".fa-refresh").removeClass("fa-spin");
                        $("#data_used").removeClass("half-transparent");
                        $("#data_total").removeClass("half-transparent");
                        $("#data_remaining").removeClass("half-transparent");
                        $(".progress-bar").removeClass("half-transparent");
                    });
                }

                $("#reload").click(function() {
                    reloadComcastQuery();
                });

                loadComcastQuery();

                setInterval(function(){
                    reloadComcastQuery();
                }, 1800000);
