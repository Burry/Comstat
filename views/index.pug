extends layout

block content
    .container
        nav.navbar.navbar-toggleable-xl.navbar-light.navbar-static-top
            button.navbar-toggler.navbar-toggler-right(type='button', data-toggle='collapse', data-target='#nav-content', aria-controls='nav-content', aria-expanded='false', aria-label='Toggle navigation')
                span.navbar-toggler-icon
            a.navbar-brand(href='#')
                if icon
                    i.fa(class=icon, aria-hidden='true')
                else
                    img.logo.align-top(src='images/logo.svg')
                =title
            .collapse.navbar-collapse.justify-content-end
                button#reload.btn.btn-secondary(type='button')
                    i.fa.fa-refresh(aria-hidden='true')

    header.jumbotron.jumbotron-fluid
        .container
            p.lead#loader
                i.fa.fa-spin.fa-circle-o-notch(aria-hidden='true')
                |  Querying Comcast
            p#data
                | Used&nbsp;
                span#data_used
                | /
                span#data_total
                | &nbsp;GB
                br
                span#data_remaining
                | &nbsp;GB remaining
            #data_progress.progress
                .progress-bar.progress-bar-striped.progress-bar-animated.bg-danger(role='progressbar', aria-valuenow='0', aria-valuemin='0', aria-valuemax='100', style='width: 75%')
            script.
                function loadComcastQuery() {
                    $.get("response", function(data) {
                        var res = JSON.parse(data);
                        var remaining = res.total - res.used;
                        var percent = 100 * res.used / res.total;
                        $("#loader").hide();
                        $("#data_used").html(res.used);
                        $("#data_total").html(res.total);
                        $("#data_remaining").html(remaining);
                        $(".progress-bar").html(Math.round(percent) + "%");
                        $(".progress-bar").css("width", percent + "%");
                        $("#data").css("display", "block");
                        $("#data_progress").css("display", "block");
                        $("#reload").css("display", "block");
                    });
                }

                function reloadComcastQuery() {
                    $(".fa-refresh").addClass("fa-spin");
                    $("#data_used").addClass("half-transparent");
                    $("#data_total").addClass("half-transparent");
                    $("#data_remaining").addClass("half-transparent");
                    $(".progress-bar").addClass("half-transparent");
                    $.get("response", function(data) {
                        var res = JSON.parse(data);
                        var remaining = res.total - res.used;
                        var percent = 100 * res.used / res.total;
                        $("#data_used").html(res.used);
                        $("#data_total").html(res.total);
                        $("#data_remaining").html(remaining);
                        $(".progress-bar").html(Math.round(percent) + "%");
                        $(".progress-bar").css("width", percent + "%");
                        $(".fa-refresh").removeClass("fa-spin");
                        $("#data_used").removeClass("half-transparent");
                        $("#data_total").removeClass("half-transparent");
                        $("#data_remaining").removeClass("half-transparent");
                        $(".progress-bar").removeClass("half-transparent");
                    });
                }

                $("#reload").click(function() {
                    reloadComcastQuery();
                });

                loadComcastQuery();

                setInterval(function(){
                    reloadComcastQuery();
                }, 1800000);
